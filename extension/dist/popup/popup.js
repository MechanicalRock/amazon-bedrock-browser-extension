import{a as P,o as l,b as d,f as n,d as K,g as c,n as N,t as h,e as v,h as A,v as C,F as w,r as k,j as S,w as M,_ as O,l as R,m as B}from"../assets/windi-2b424cd6.js";import{c as F,P as E,b as U,k as G,g as V,a as W,e as Y,j as D,i as j}from"../assets/tabs-4887e7c1.js";import{l as z,A as y,E as p}from"../assets/constants-0cd32530.js";const H={},Q={class:"lds-ring"},J=n("div",null,null,-1),X=n("div",null,null,-1),Z=n("div",null,null,-1),q=n("div",null,null,-1),x=[J,X,Z,q];function ee(e,a){return l(),d("div",Q,x)}const se=P(H,[["render",ee]]);var te=(e="")=>{const a=F();let o,r=[];const g=V(),_=new Set,m=new Set,f=(s,b)=>{switch(s.status){case"undeliverable":r.some(i=>i.message.messageID===s.message.messageID)||(r=[...r,{message:s.message,resolvedDestination:s.resolvedDestination}]);return;case"deliverable":r=r.reduce((i,u)=>u.resolvedDestination===s.deliverableTo?(E.toBackground(b,{type:"deliver",message:u.message}),i):[...i,u],[]);return;case"delivered":s.receipt.message.messageType==="message"&&g.add(s.receipt);return;case"incoming":s.message.messageType==="reply"&&g.remove(s.message.messageID),_.forEach(i=>i(s.message,b));return;case"terminated":{const i=g.entries().filter(u=>s.fingerprint===u.to);g.remove(i),i.forEach(({message:u})=>m.forEach($=>$(u)))}}},t=()=>{o=U.runtime.connect({name:G({endpointName:e,fingerprint:a})}),o.onMessage.addListener(f),o.onDisconnect.addListener(t),E.toBackground(o,{type:"sync",pendingResponses:g.entries(),pendingDeliveries:[...new Set(r.map(({resolvedDestination:s})=>s))]})};return t(),{onFailure(s){m.add(s)},onMessage(s){_.add(s)},postMessage(s){E.toBackground(o,{type:"deliver",message:s})}}},I=te("popup"),L=W("popup",e=>I.postMessage(e));I.onMessage(L.handleMessage);var{sendMessage:T,onMessage:ae}=L;Y(L);const ne=K({data(){return{status:"",message:"",region:"",accessKeyId:"",secretAccessKey:"",cachingEnabled:!1,form:{sourceLang:"auto",targetLang:"en"},languages:z,prevtargetLang:""}},mounted(){this.region=c(y.AWS_REGION,""),this.accessKeyId=c(y.AWS_ACCESS_KEY_ID,""),this.secretAccessKey=c(y.AWS_SECRET_ACCESS_KEY,""),this.form.sourceLang=c(p.DEFAULT_SOURCE_LANG,"auto"),this.form.targetLang=c(p.DEFAULT_TARGET_LANG,"en"),this.cachingEnabled=c(p.CACHING_ENABLED,!1),this.prevtargetLang=c(p.DEFAULT_SOURCE_LANG,"auto"),this.bedrockEnabled=c(p.BEDROCK_ENABLED,!1),ae("status",async({data:e})=>{const a=e,{status:o,message:r}=a;window.console.log("status message received in popup: "+r),this.status=o,this.message=r})},methods:{async translatePage(e){try{if(e.preventDefault(),this.status="",this.message="",[this.region,this.accessKeyId,this.secretAccessKey].includes(""))throw new Error("Your credentials are invalid.");if(this.prevtargetLang===this.form.targetLang){this.status="complete",this.message="Translation already in target language";return}const a={accessKeyId:this.accessKeyId,secretAccessKey:this.secretAccessKey},o={region:this.region,credentials:a},r=await D(),g={creds:o,langs:{source:this.form.sourceLang===c(p.DEFAULT_SOURCE_LANG,"auto")?this.prevtargetLang:this.form.sourceLang,target:this.form.targetLang},tabId:r,cachingEnabled:this.cachingEnabled,bedrockEnabled:this.bedrockEnabled};this.prevtargetLang=this.form.targetLang,T("translate",g,"content-script@"+r)}catch{this.status="error",this.message=`An error occurred when attempting to translate.
 Please check your credentials and try again.`}},openOptionsPage(){j.runtime.openOptionsPage()},async clearPageCache(){window.console.log("clear page cache button clicked");const e=await D();T("clearCache",{tabId:e},`content-script@${e}`),window.console.log("a message sent to content script for clearing cache")}}});const re={class:"popup-container"},oe=n("h1",{class:"header"},"Amazon Translate",-1),ie=n("p",null,"Select your source and target languages.",-1),ce={class:"form-container popup"},le=["value"],de=["value"],ge={key:0},ue={class:"links"},pe=n("br",null,null,-1);function me(e,a,o,r,g,_){const m=se,f=O;return l(),d("main",re,[oe,ie,e.status!==""&&e.status!=="translating"?(l(),d("div",{key:0,class:N(["form-message text-left",{hasError:e.status==="error"}]),style:{"max-width":"245px",margin:"auto"}},h(e.message),3)):v("",!0),n("form",ce,[n("div",null,[A(n("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>e.form.sourceLang=t),class:"aws-field"},[(l(!0),d(w,null,k(e.languages,t=>(l(),d("option",{key:t.code,value:t.code},h(t.label),9,le))),128))],512),[[C,e.form.sourceLang]])]),n("div",null,[A(n("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>e.form.targetLang=t),class:"aws-field"},[(l(!0),d(w,null,k(e.languages,t=>(l(),d("option",{key:t.code,value:t.code},h(t.label),9,de))),128))],512),[[C,e.form.targetLang]])]),n("div",null,[S(f,{class:"submit-button",variant:"attention",disabled:e.status==="translating",onClick:e.translatePage},{default:M(()=>[e.status==="translating"?(l(),d("span",ge,[S(m)])):v("",!0),R(" "+h(e.status==="translating"?"Translating...":"Translate"),1)]),_:1},8,["disabled","onClick"])])]),n("div",ue,[n("a",{onClick:a[2]||(a[2]=(...t)=>e.openOptionsPage&&e.openOptionsPage(...t)),href:"#"},"Extension Settings"),pe,e.cachingEnabled?(l(),d("a",{key:0,onClick:a[3]||(a[3]=(...t)=>e.clearPageCache&&e.clearPageCache(...t)),href:"#"},"Clear Cache for this Page")):v("",!0)])])}const he=P(ne,[["render",me]]),_e=B(he);_e.mount("#app");
